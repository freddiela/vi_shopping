<!--{include(pe_tpl('header.html','admin'));}-->
<style>
    /*购物车*/
    .wgw_box {
        text-align: center;
        margin: 0 auto 150px;
    }

    .wgw_btn {
        background: url(../images/wgw.png) no-repeat;
        background-size: 80px auto;
        width: 80px;
        height: 80px;
        text-align: center;
        margin: 8em auto 0
    }

    .g_btn {
        margin-top: 25px;
    }

    .g_btn a {
        padding: 6px 30px;
        border: 1px #999 solid;
        font-size: 14px;
        border-radius: 4px;
        color: #666;
    }

    .liucheng {
        font-size: 16px;
        border-left: 3px #666 solid;
        padding-left: 12px;
        line-height: 16px;
        margin-top: 30px;
        margin-bottom: 30px;
        font-family: "微软雅黑";
        color: #555;
    }

    .zongji {
        text-align: right;
        padding-top: 10px;
    }

    .qingkong a {
        display: block;
        background: #ffaa00;
        width: 135px;
        height: 37px;
    }

    .jiesuan a {
        display: block;
        background: #ffaa00;
        width: 135px;
        height: 37px;
        font-weight: bold;
        color: #fff;
        font-size: 14px;
        text-align: center;
        line-height: 36px;
    }

    .jixu a {
        display: block;
        background: #ffaa00;
        width: 135px;
        height: 37px;
    }

    .gwc_tb th {
        background: #f7f7f7;
        height: 38px;
        padding: 5px 10px;
        font-size: 14px;
        font-weight: normal;
        border-bottom: 1px #eee solid;
        border-top: 1px #EBEBEB solid;
    }

    .gouwuche td {
        padding: 20px 10px;
        text-align: center;
        border-bottom: 1px #ebebeb solid;
        vertical-align: top;
    }

    .gouwuche {
        border: 1px #ebebeb solid;
        border-top: 0;
        border-bottom: 0;
        background: #fff;
    }

    .order_addbox {
        padding: 10px 20px;
        margin-top: 15px;
        background: #fff;
        color: #666;
        font-family: "微软雅黑";
        font-size: 14px;
    }

    .gwc_tb {
        font-family: "微软雅黑";
    }

    .dddz_l {
        padding: 0 18px 0 0;
    }

    .dddz_r {
        float: right;
        width: 380px;
        padding: 10px 15px;
    }

    .ddtj_btn {
        background: #ff666b;
        color: #fff;
        width: 138px;
        border: 0;
        height: 40px;
        line-height: 38px;
        text-align: center;
        position: relative;
        font-size: 15px;
        cursor: pointer;
        font-family: "微软雅黑";
        float: right;
        margin: 5px 5px 0 20px;
        border-radius: 4px;
    }

    .ddtj_btn1 {
        height: 40px;
        line-height: 38px;
    }

    .ddtj_btn_box {
        margin-top: 20px;
        background: #efefef;
        height: 50px;
        line-height: 50px;
        font-size: 12px;
        font-family: "宋体";
        padding-left: 15px;
        color: #666;
    }

    .ddtj_btn_box a {
        color: #666;
    }

    .fpxx_box {
        border: 1px #ddd solid;
        margin-top: 15px;
        font-family: "微软雅黑";
        font-size: 14px;
    }

    .fpxx_dw {
        padding: 20px 18px;
        position: relative
    }

    .taitoumc {
        position: absolute;
        left: 80px;
        width: 230px;
        height: 50px;
        border: 0;
        line-height: 50px;
        font-family: "微软雅黑";
        font-size: 14px;
    }

    .shuliang {
        height: 24px;
        overflow: hidden;
    }

    .shuliang .img1 {
        float: left;
        height: 27px;
        display: block;
        text-align: center;
        width: 26px;
        cursor: pointer;
    }

    .shuliang .img1 i {
        background: url(/template/index/images/jia_ico.png) no-repeat 0 -33px;
        display: block;
        width: 26px;
        height: 27px
    }

    .shuliang .img2 {
        float: left;
        height: 27px;
        display: block;
        text-align: center;
        width: 26px;
        cursor: pointer;
    }

    .shuliang .img2 i {
        background: url(/template/index/images/jia_ico.png) no-repeat;
        display: block;
        width: 26px;
        height: 27px
    }

    .shuliang input {
        width: 40px;
        font-size: 12px;
        border: 0;
        height: 25px;
        line-height: 25px;
        text-align: center;
        color: #666
    }

    .shuliang_box {
        border: 1px solid #e6e6e6;
        border-left: 0;
        border-right: 0;
        float: left;
        height: 25px;
        line-height: 25px;
        color: #333;
        font-size: 14px;
    }
</style>
<div class="right">
    <div class="now">
        <a href="javascript:;" class="sel">{$menutitle}<i></i></a>
        <a href="webadmin.php?mod=user&act=product_list&id={$user_id}"
            onclick="return pe_dialog(this, '选择购物车商品', 1000, 550)" id="fabu">选择商品</a>
        <div class="clear"></div>
    </div>
    <div class="right_main">
        <div class="gouwuche">
            <table width="100%" border="0" cellspacing="0" cellpadding="0" class="gwc_tb">
                <tr>
                    <th width="20"></th>
                    <th width="90">商品图片</th>
                    <th>商品信息</th>
                    <th width="150"></th>
                    <th width="80">单价</th>
                    <th width="120">数量</th>
                    <th width="80">小计</th>
                    <th width="80">操作</th>
                </tr>
                <!--{foreach($info_list as $k=>$v):}-->
                <tr class="js_cart" cart_id="{$v['cart_id']}">
                    <!--{if($v['error']['del']):}-->
                    <td></td>
                    <!--{else:}-->
                    <td style="vertical-align:middle">
                        <!-- <input type="checkbox" name="cart_id[]" value="{$v['cart_id']}" /> -->
                    </td>
                    <!--{endif;}-->
                    <td class="hotimg1"><img src="{pe_thumb($v['product_logo'], 100, 100)}" /></td>
                    <td style="text-align:left;padding-left:0">
                        <a href="{pe_url('product-'.$v['product_id'])}" target="_blank"
                            class="cblue">{$v['product_name']}</a>
                    </td>
                    <td style="text-align:left;">
                        <div class="c888">{order_skushow($v['product_rule'])}</div>
                    </td>
                    <td class="num">¥ {$v['product_money']}</td>
                    <td class="shuliang">
                        <!--{if($v['error']['del']):}-->
                        <input type="hidden" name="cart_num[]" value="{$v['product_num']}"
                            product_money="{$v['product_money']}" />
                        <p class="cred">{$v['error']['show']}</p>
                        <!--{else:}-->
                        <span class="img1 mal10" onclick="cart_edit('-', '{$v['cart_id']}');"><i></i></span>
                        <div class="shuliang_box"><input type="text" name="cart_num[]" value="{$v['product_num']}"
                                product_money="{$v['product_money']}" readonly /></div>
                        <span class="img2" onclick="cart_edit('+', '{$v['cart_id']}');"><i></i></span>
                        <div class="clear"></div>
                        <p class="cred mat10">{$v['error']['show']}</p>
                        <!--{endif;}-->
                    </td>
                    <td class="num corg product_allmoney">¥ {$v['product_allmoney']}</td>
                    <td><a href="javascript:;" onclick="cart_edit('del', '{$v['cart_id']}')">删除</a></td>
                </tr>
                <!--{endforeach;}-->
            </table>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(function () {
        $.getJSON("http://www.phpshe.com/index.php?mod=api&act=ipname&ip={$info['user_ip']}&callback=?", function (json) {
            $(".ipname").html(json.ipname);
        })
    })
    function cart_edit(type, cart_id) {
        var js_cart = $(".js_cart[cart_id='" + cart_id + "']");
        var _this = js_cart.find(":input[name='cart_num[]']");
        if (type == 'del') {
            var num = 0;
        }
        else {
            var num = parseInt(_this.val());
            num = type == '+' ? num + 1 : (num >= 1 ? num - 1 : 0);
        }
        if (num == 0) {
            if (confirm('您确认要删除该商品吗?') == false) return;
        }
		pe_getinfo("{$pe['host_root']}admin/webadmin.php?mod=user&act=cart_edit&id=" + cart_id + "&num=" + num, function (json) {
            
            if (json.result) {
                if (num == 0) js_cart.remove();
            }
        })

    }
    function cart_money() {
        if ($(".js_cart").length == 0) {
            $(".wgw_box").show();
            $(".content").hide();
        }
        else {
            $(".wgw_box").hide();
            $(".content").show();
        }
        var product_money = 0, product_num = 0, order_money = 0, order_num = 0;
        $(":input[name='cart_id[]']:checked").each(function () {
            var _this = $(this).parents(".js_cart").find(":input[name='cart_num[]']");
            product_money = pe_num(_this.attr("product_money"), 'round', 1);
            product_num = pe_num(_this.val(), 'floor');
            order_money += product_money * product_num;
            order_num += product_num;
        })
        $("#order_money").html(pe_num(order_money, 'round', 1, true));
        $("#order_num").html(order_num);
    }
</script>
<!--{include(pe_tpl('footer.html','admin'));}-->